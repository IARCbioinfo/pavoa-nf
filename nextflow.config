manifest {
    homePage = 'https://github.com/iarcbioinfo/pavoa-nf'
    description = 'Pipeline for variant detection: Preprocessing, Alignment, Variant calling, Optimization, Annotation'
    mainScript = 'main.nf'
}

profiles {
  conda { 
    process.conda = "$baseDir/environment.yml"
    conda.createTimeout = "200 min"
  }
  singularity { 
    singularity.enabled = true 
    pullTimeout = "200 min"
  }
  apptainer {
    apptainer.enabled = true
    pullTimeout = "200 min"
  }

  // iarc conf and files for hg38/GRCh38
  hg38_old {
    params {
      cpu = 16
      mem = 64
      cpu_bqsr = 16
      mem_bqsr = 120
      cpu_dupcaller = 64
      mem_dupcaller = 32
      ref = '/data/mca_share/work/hg38/alignment_nf/Homo_sapiens_assembly38/Homo_sapiens_assembly38.fasta'
      feature_file = '/data/mca_share/work/capture_files/hg38.bed'
      known_sites = [
        '/data/references/Homo_sapiens/GATK/hg38/gatk-best-practices/somatic-hg38/af-only-gnomad.hg38.vcf.gz',
        '/data/references/Homo_sapiens/GATK/hg38/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz'
      ]
      //PON = '/data/references/Homo_sapiens/GATK/hg38/gatk-best-practices/somatic-hg38/1000g_pon.hg38.vcf.gz'
      annovarDBlist  = '/data/mca_share/work/annovar/hg38_listAVDB_old.txt'
      annovarDBpath  = '/data/mca_share/work/annovar/hg38db/'
      annovarBinPath = '/data/mca_share/work/annovar/'
    }
  }

  hg38 {
    params {
      cpu = 16
      mem = 64
      cpu_bqsr = 16
      mem_bqsr = 120
      cpu_dupcaller = 64
      mem_dupcaller = 32
      ref = '/data/references/pavoa/hg38/Homo_sapiens_assembly38.fasta'
      feature_file = '/data/references/pavoa/hg38/hg38.bed'
      known_sites = [
        '/data/references/pavoa/hg38/af-only-gnomad.hg38.vcf.gz',
        '/data/references/pavoa/hg38/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz'
      ]
      //PON = '/data/references/Homo_sapiens/GATK/hg38/gatk-best-practices/somatic-hg38/1000g_pon.hg38.vcf.gz'
      annovarDBlist  = '/data/references/pavoa/annovar/hg38_listAVDB.txt'
      annovarDBpath  = '/data/references/pavoa/annovar/hg38db/'
      annovarBinPath = '/data/references/pavoa/annovar/'
    }
  }

    // iarc conf and files for hg38/GRCh38
  mm39 {
    params {
      cpu = 16
      mem = 64
      cpu_bqsr = 16
      mem_bqsr = 120
      cpu_dupcaller = 64
      mem_dupcaller = 32
      ref = '/data/references/pavoa/mm39/mm39_masked.fa'
      feature_file = '/data/references/pavoa/mm39/mm39.bed'
      known_sites = [
        '/data/references/pavoa/mm39/mgp_REL2021_snps.rsID.vcf.gz',
        '/data/references/pavoa/mm39/mgp_REL2021_indels.rsID.vcf.gz'
      ]
      //PON = ''
      annovarDBlist  = '/data/references/pavoa/annovar/mm39_listAVDB.txt'
      annovarDBpath  = '/data/references/pavoa/annovar/mm39db/'
      annovarBinPath = '/data/references/pavoa/annovar/'
    }
  }

}

process {
    shell =  ['/bin/bash','-o','pipefail']

    withLabel:trimgalore{
      container = 'docker://quay.io/microbiome-informatics/trim_galore:0.6.7'
    }

    withLabel:alignment{
      container = 'iarcbioinfo/bwa-mem2-tools:v1.0'
    }

    withLabel:gatk{
      container = 'shub://IARCbioinfo/alignment-nf:v1.3'
    }

    withLabel:dupcaller{
      container = 'iarcbioinfo/dupcaller:v1.0'
    }

    withLabel:multiqc{
      container = 'docker://quay.io/biocontainers/multiqc:1.29--pyhdfd78af_0'
    }

    withLabel:qualimap{
      container = 'docker://quay.io/viascientific/qualimap:2.3'
    }

    withLabel:annotation{
      container = 'iarcbioinfo/gama_annot-nf:v1.2'
    }

    withLabel:annovar{
      container = 'bioinfochrustrasbourg/annovar:latest'
    }

    withLabel:mutect2{
      container = 'iarcbioinfo/mutect-nf:v2.3'
    }

    withLabel:strelka2{
      container = 'shub://IARCbioinfo/strelka2-nf:v1.2'
    }
    


}

params.output_folder = "pavoa_" + new Date().format('yyyyMMdd')

timeline {
  enabled = true
  overwrite = true
  file = "${params.output_folder}/nf-pipeline_info/alignment-nf_timeline.html"
}

report {
  enabled = true
  overwrite = true
  file = "${params.output_folder}/nf-pipeline_info/alignment-nf_report.html"
}

trace {
  enabled = true
  overwrite = true
  file = "${params.output_folder}/nf-pipeline_info/alignment-nf_trace.txt"
}

dag {
  enabled = true
  overwrite = true
  file = "${params.output_folder}/nf-pipeline_info/alignment-nf_dag.html"
}


